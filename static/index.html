<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRUFC Scoreboard Control</title>
    <style>
        :root {
            /* Light mode (default) */
            --bg-primary: #f0f0f0;
            --bg-secondary: white;
            --text-primary: #333;
            --text-secondary: #495057;
            --border-color: #dee2e6;
            --shadow: rgba(0,0,0,0.1);
            --input-bg: white;
            --input-border: #ced4da;
            
            /* Status colors */
            --status-connected-bg: #d4edda;
            --status-connected-text: #155724;
            --status-connected-border: #c3e6cb;
            --status-disconnected-bg: #f8d7da;
            --status-disconnected-text: #721c24;
            --status-disconnected-border: #f5c6cb;
            
            /* Button colors */
            --btn-primary: #007bff;
            --btn-success: #28a745;
            --btn-warning: #ffc107;
            --btn-danger: #dc3545;
            --btn-text: white;
        }

        [data-theme="dark"] {
            /* Dark mode */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --border-color: #404040;
            --shadow: rgba(255,255,255,0.1);
            --input-bg: #404040;
            --input-border: #555555;
            
            /* Status colors (adjusted for dark mode) */
            --status-connected-bg: #1e4620;
            --status-connected-text: #90ee90;
            --status-connected-border: #2d5a2f;
            --status-disconnected-bg: #4a1e1e;
            --status-disconnected-text: #ffb3b3;
            --status-disconnected-border: #5a2d2d;
            
            /* Button colors remain the same but with better contrast */
            --btn-primary: #0d6efd;
            --btn-success: #198754;
            --btn-warning: #ffc107;
            --btn-danger: #dc3545;
            --btn-text: white;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            box-shadow: 0 2px 10px var(--shadow);
            padding: 20px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .theme-toggle {
            background: none;
            border: 2px solid var(--text-primary);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .theme-toggle:hover {
            background-color: var(--text-primary);
            color: var(--bg-secondary);
        }
        .status {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.connected {
            background-color: var(--status-connected-bg);
            color: var(--status-connected-text);
            border: 1px solid var(--status-connected-border);
        }
        .status.disconnected {
            background-color: var(--status-disconnected-bg);
            color: var(--status-disconnected-text);
            border: 1px solid var(--status-disconnected-border);
        }
        .scoreboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 24px;
            border-radius: 10px;
            min-height: 120px;
        }
        .team {
            text-align: center;
            padding: 10px;
            border: 2px solid #00ff00;
            border-radius: 5px;
        }
        .team-name {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .team-score {
            font-size: 48px;
            font-weight: bold;
            color: #ffffff;
        }
        .timer {
            grid-column: span 2;
            text-align: center;
            font-size: 36px;
            padding: 20px;
            border: 2px solid #ff0000;
            border-radius: 5px;
            color: #ff0000;
        }
        .timer.running {
            background-color: #330000;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .control-group {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .control-group h3 {
            margin-top: 0;
            color: var(--text-secondary);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-secondary);
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            background-color: var(--input-bg);
            color: var(--text-primary);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        button {
            background-color: var(--btn-primary);
            color: var(--btn-text);
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 5px 5px 0;
            transition: background-color 0.3s ease;
        }
        button:hover {
            filter: brightness(0.9);
        }
        button.success {
            background-color: var(--btn-success);
        }
        button.warning {
            background-color: var(--btn-warning);
            color: #212529;
        }
        button.danger {
            background-color: var(--btn-danger);
        }
        }
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }
        .message.success {
            background-color: var(--status-connected-bg);
            color: var(--status-connected-text);
            border: 1px solid var(--status-connected-border);
        }
        .message.error {
            background-color: var(--status-disconnected-bg);
            color: var(--status-disconnected-text);
            border: 1px solid var(--status-disconnected-border);
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .timer-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .timer-input input {
            width: 60px;
        }
        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            .scoreboard {
                grid-template-columns: 1fr;
                font-size: 18px;
            }
            .team-score {
                font-size: 36px;
            }
            .timer {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HRUFC Rugby Scoreboard Control</h1>
            <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
            <div id="status" class="status disconnected">
                Connection Status: Disconnected
            </div>
            <div id="simulation-status" class="status" style="display: none;">
                Simulation Mode: Active
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 20px;">
            <a href="/config" style="color: #007bff; text-decoration: none; padding: 10px 20px; border: 1px solid #007bff; border-radius: 4px;">‚öôÔ∏è Configuration</a>
        </div>

        <div class="scoreboard">
            <div class="team">
                <div class="team-name" id="home-name">HOME</div>
                <div class="team-score" id="home-score">0</div>
            </div>
            <div class="team">
                <div class="team-name" id="away-name">AWAY</div>
                <div class="team-score" id="away-score">0</div>
            </div>
            <div id="timer" class="timer">00:00</div>
        </div>

        <div id="message" class="message"></div>

        <div class="controls">
            <div class="control-group">
                <h3>Team Names</h3>
                <div class="form-group">
                    <label for="home-team-input">Home Team:</label>
                    <input type="text" id="home-team-input" value="HOME" maxlength="20">
                </div>
                <div class="form-group">
                    <label for="away-team-input">Away Team:</label>
                    <input type="text" id="away-team-input" value="AWAY" maxlength="20">
                </div>
                <button onclick="updateTeams()">Update Teams</button>
            </div>

            <div class="control-group">
                <h3>Score Control</h3>
                <div class="form-group">
                    <label for="home-score-input">Home Score:</label>
                    <input type="number" id="home-score-input" value="0" min="0" max="999">
                </div>
                <div class="form-group">
                    <label for="away-score-input">Away Score:</label>
                    <input type="number" id="away-score-input" value="0" min="0" max="999">
                </div>
                <div class="button-group">
                    <button onclick="updateScores()">Update Scores</button>
                    <button class="success" onclick="incrementScore('home')">Home +1</button>
                    <button class="success" onclick="incrementScore('away')">Away +1</button>
                    <button class="danger" onclick="resetScores()">Reset Scores</button>
                </div>
            </div>

            <div class="control-group">
                <h3>Rugby Scoring</h3>
                <div class="form-group">
                    <label>Home Team:</label>
                    <div class="button-group">
                        <button class="success" onclick="addTry('home')">Add Try (+5)</button>
                        <button class="warning" onclick="removeTry('home')">Remove Try (-5)</button>
                        <button class="success" onclick="addConversion('home')">Add Conversion (+2)</button>
                        <button class="warning" onclick="removeConversion('home')">Remove Conversion (-2)</button>
                        <button class="success" onclick="addPenalty('home')">Add Penalty (+3)</button>
                        <button class="warning" onclick="removePenalty('home')">Remove Penalty (-3)</button>
                        <button class="success" onclick="addPenaltyTry('home')">Add Penalty Try (+7)</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Away Team:</label>
                    <div class="button-group">
                        <button class="success" onclick="addTry('away')">Add Try (+5)</button>
                        <button class="warning" onclick="removeTry('away')">Remove Try (-5)</button>
                        <button class="success" onclick="addConversion('away')">Add Conversion (+2)</button>
                        <button class="warning" onclick="removeConversion('away')">Remove Conversion (-2)</button>
                        <button class="success" onclick="addPenalty('away')">Add Penalty (+3)</button>
                        <button class="warning" onclick="removePenalty('away')">Remove Penalty (-3)</button>
                        <button class="success" onclick="addPenaltyTry('away')">Add Penalty Try (+7)</button>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <h3>Timer Control</h3>
                <div class="form-group">
                    <label>Set Timer:</label>
                    <div class="timer-input">
                        <input type="number" id="timer-minutes" value="0" min="0" max="99">
                        <span>:</span>
                        <input type="number" id="timer-seconds" value="0" min="0" max="59">
                    </div>
                </div>
                <div class="button-group">
                    <button onclick="setTimer()">Set Timer</button>
                    <button class="success" onclick="startTimer()">Start</button>
                    <button class="warning" onclick="stopTimer()">Stop</button>
                    <button class="danger" onclick="resetTimer()">Reset</button>
                </div>
                <div class="form-group">
                    <label>Rugby Periods:</label>
                    <div class="button-group">
                        <button class="success" onclick="startFirstHalf()">Start First Half</button>
                        <button class="success" onclick="startSecondHalf()">Start Second Half</button>
                        <button class="warning" onclick="endPeriod()">End Period</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentState = {
            connected: false,
            home_team: 'HOME',
            away_team: 'AWAY',
            home_score: 0,
            away_score: 0,
            timer_minutes: 0,
            timer_seconds: 0,
            timer_running: false,
            simulation_mode: false
        };

        // Update UI with current state
        function updateUI(state) {
            currentState = state;
            
            // Update connection status
            const statusEl = document.getElementById('status');
            if (state.connected) {
                statusEl.className = 'status connected';
                if (state.simulation_mode) {
                    statusEl.textContent = 'Connection Status: Simulation Mode';
                } else {
                    statusEl.textContent = 'Connection Status: Connected';
                }
            } else {
                statusEl.className = 'status disconnected';
                statusEl.textContent = 'Connection Status: Disconnected';
            }

            // Show/hide simulation status
            const simStatusEl = document.getElementById('simulation-status');
            if (state.simulation_mode) {
                simStatusEl.style.display = 'block';
                simStatusEl.className = 'status connected';
                simStatusEl.textContent = 'Simulation Mode: Active';
            } else {
                simStatusEl.style.display = 'none';
            }

            // Update scoreboard display
            document.getElementById('home-name').textContent = state.home_team;
            document.getElementById('away-name').textContent = state.away_team;
            document.getElementById('home-score').textContent = state.home_score;
            document.getElementById('away-score').textContent = state.away_score;

            // Update timer display
            const timerEl = document.getElementById('timer');
            const timeDisplay = `${String(state.timer_minutes).padStart(2, '0')}:${String(state.timer_seconds).padStart(2, '0')}`;
            timerEl.textContent = timeDisplay;
            timerEl.className = state.timer_running ? 'timer running' : 'timer';

            // Update form inputs
            document.getElementById('home-team-input').value = state.home_team;
            document.getElementById('away-team-input').value = state.away_team;
            document.getElementById('home-score-input').value = state.home_score;
            document.getElementById('away-score-input').value = state.away_score;
            document.getElementById('timer-minutes').value = state.timer_minutes;
            document.getElementById('timer-seconds').value = state.timer_seconds;
        }

        // Show message to user
        function showMessage(text, isError = false) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${isError ? 'error' : 'success'}`;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }

        // API helper function
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`/api/${endpoint}`, options);
                const result = await response.json();
                
                if (result.success) {
                    return result;
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // Load current status
        async function loadStatus() {
            try {
                const result = await apiCall('status');
                updateUI(result.data);
            } catch (error) {
                console.error('Failed to load status:', error);
                showMessage('Failed to load status from server', true);
            }
        }

        // Update team names
        async function updateTeams() {
            const homeTeam = document.getElementById('home-team-input').value.trim();
            const awayTeam = document.getElementById('away-team-input').value.trim();
            
            if (!homeTeam || !awayTeam) {
                showMessage('Team names cannot be empty', true);
                return;
            }
            
            try {
                await apiCall('teams', 'POST', { home_team: homeTeam, away_team: awayTeam });
                showMessage('Teams updated successfully');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to update teams: ${error.message}`, true);
            }
        }

        // Update scores
        async function updateScores() {
            const homeScore = parseInt(document.getElementById('home-score-input').value);
            const awayScore = parseInt(document.getElementById('away-score-input').value);
            
            try {
                await apiCall('scores', 'POST', { home_score: homeScore, away_score: awayScore });
                showMessage('Scores updated successfully');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to update scores: ${error.message}`, true);
            }
        }

        // Increment score
        async function incrementScore(team) {
            try {
                await apiCall(`scores/${team}/increment`, 'POST');
                showMessage(`${team.charAt(0).toUpperCase() + team.slice(1)} score incremented`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to increment ${team} score: ${error.message}`, true);
            }
        }

        // Reset scores
        async function resetScores() {
            if (confirm('Are you sure you want to reset all scores to 0?')) {
                try {
                    await apiCall('scores/reset', 'POST');
                    showMessage('Scores reset to 0');
                    loadStatus();
                } catch (error) {
                    showMessage(`Failed to reset scores: ${error.message}`, true);
                }
            }
        }

        // Set timer
        async function setTimer() {
            const minutes = parseInt(document.getElementById('timer-minutes').value);
            const seconds = parseInt(document.getElementById('timer-seconds').value);
            
            if (seconds >= 60) {
                showMessage('Seconds must be less than 60', true);
                return;
            }
            
            try {
                await apiCall('timer', 'POST', { minutes, seconds });
                showMessage(`Timer set to ${minutes}:${String(seconds).padStart(2, '0')}`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to set timer: ${error.message}`, true);
            }
        }

        // Start timer
        async function startTimer() {
            try {
                await apiCall('timer/start', 'POST');
                showMessage('Timer started');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to start timer: ${error.message}`, true);
            }
        }

        // Stop timer
        async function stopTimer() {
            try {
                await apiCall('timer/stop', 'POST');
                showMessage('Timer stopped');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to stop timer: ${error.message}`, true);
            }
        }

        // Reset timer
        async function resetTimer() {
            try {
                await apiCall('timer/reset', 'POST');
                showMessage('Timer reset');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to reset timer: ${error.message}`, true);
            }
        }

        // Rugby scoring functions
        
        // Add try (5 points)
        async function addTry(team) {
            try {
                await apiCall('rugby/try', 'POST', { team: team });
                showMessage(`Try added for ${team.charAt(0).toUpperCase() + team.slice(1)} team (+5 points)`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to add try: ${error.message}`, true);
            }
        }

        // Remove try (5 points)
        async function removeTry(team) {
            try {
                await apiCall('rugby/try', 'DELETE', { team: team });
                showMessage(`Try removed for ${team.charAt(0).toUpperCase() + team.slice(1)} team (-5 points)`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to remove try: ${error.message}`, true);
            }
        }

        // Add conversion (2 points)
        async function addConversion(team) {
            try {
                await apiCall('rugby/conversion', 'POST', { team: team });
                showMessage(`Conversion added for ${team.charAt(0).toUpperCase() + team.slice(1)} team (+2 points)`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to add conversion: ${error.message}`, true);
            }
        }

        // Add penalty (3 points)
        async function addPenalty(team) {
            try {
                await apiCall('rugby/penalty', 'POST', { team: team });
                showMessage(`Penalty added for ${team.charAt(0).toUpperCase() + team.slice(1)} team (+3 points)`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to add penalty: ${error.message}`, true);
            }
        }

        // Remove conversion (2 points)
        async function removeConversion(team) {
            try {
                await apiCall('rugby/conversion', 'DELETE', { team: team });
                showMessage(`Conversion removed for ${team.charAt(0).toUpperCase() + team.slice(1)} team (-2 points)`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to remove conversion: ${error.message}`, true);
            }
        }

        // Remove penalty (3 points)
        async function removePenalty(team) {
            try {
                await apiCall('rugby/penalty', 'DELETE', { team: team });
                showMessage(`Penalty removed for ${team.charAt(0).toUpperCase() + team.slice(1)} team (-3 points)`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to remove penalty: ${error.message}`, true);
            }
        }

        // Add penalty try (7 points)
        async function addPenaltyTry(team) {
            try {
                await apiCall('rugby/penalty-try', 'POST', { team: team });
                showMessage(`Penalty try added for ${team.charAt(0).toUpperCase() + team.slice(1)} team (+7 points)`);
                loadStatus();
            } catch (error) {
                showMessage(`Failed to add penalty try: ${error.message}`, true);
            }
        }

        // Rugby period controls

        // Start first half
        async function startFirstHalf() {
            try {
                await apiCall('rugby/start-first-half', 'POST');
                showMessage('First half started');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to start first half: ${error.message}`, true);
            }
        }

        // Start second half
        async function startSecondHalf() {
            try {
                await apiCall('rugby/start-second-half', 'POST');
                showMessage('Second half started');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to start second half: ${error.message}`, true);
            }
        }

        // End current period
        async function endPeriod() {
            try {
                await apiCall('rugby/end-period', 'POST');
                showMessage('Period ended');
                loadStatus();
            } catch (error) {
                showMessage(`Failed to end period: ${error.message}`, true);
            }
        }

        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô Dark Mode';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è Light Mode';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialize theme from localStorage
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è Light Mode';
            } else {
                themeToggle.textContent = 'üåô Dark Mode';
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            loadStatus();
            
            // Auto-refresh status every 5 seconds
            setInterval(loadStatus, 5000);
        });
    </script>
</body>
</html>